<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reset Password</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="token-page-body">

    <div class="token-container">
        <h2>Reset Your Password</h2>

        <!-- Display message -->
        {% if message %}
        <p style="color: {% if '✅' in message %}green{% else %}red{% endif %};">
            {{ message|safe }}
        </p>
        {% endif %}

        <!-- Reset password form -->
        <form method="POST">
            <input id="password" type="password" name="password"
                   placeholder="Enter new password" required>

            <input type="password" name="confirm_password"
                   placeholder="Confirm new password" required>

            <!-- Live password checklist -->
            <ul class="pw-checklist" id="pwChecklistLive">
              <li data-k="len"><span class="pw-icon">❌</span> At least 8 characters</li>
              <li data-k="upper"><span class="pw-icon">❌</span> Uppercase letter</li>
              <li data-k="lower"><span class="pw-icon">❌</span> Lowercase letter</li>
              <li data-k="digit"><span class="pw-icon">❌</span> Number (0–9)</li>
              <li data-k="special"><span class="pw-icon">❌</span> Special character (!@#…)</li>
            </ul>

            <button type="submit">Update Password</button>
        </form>

        <a href="{{ url_for('Authentication.login') }}">Back to Login</a>
    </div>

<!--  Live password checklist  -->
<script>
(function() {
    const pw   = document.getElementById('password');
    const list = document.getElementById('pwChecklistLive');

    // Password rules check
    function evalPw(v) {
        return {
            len: v.length >= 8,
            upper: /[A-Z]/.test(v),
            lower: /[a-z]/.test(v),
            digit: /\d/.test(v),
            special: /[^A-Za-z0-9]/.test(v)
        };
    }

    // Update each checklist item
    function setRow(k, ok) {
        const li = list.querySelector(`li[data-k="${k}"]`);
        if (!li) return;
        li.classList.toggle('pw-ok', ok);
        li.classList.toggle('pw-bad', !ok);
        li.querySelector('.pw-icon').textContent = ok ? '✅' : '❌';
    }

    // Real-time password validation
    pw.addEventListener('input', () => {
        const c = evalPw(pw.value);
        ['len','upper','lower','digit','special'].forEach(k => setRow(k, c[k]));

        const allOk = Object.values(c).every(Boolean);
        pw.classList.toggle('is-invalid', !allOk && pw.value.length > 0);
        pw.classList.toggle('is-valid',   allOk);
    });
})();


// Show/hide password checklist on focus/blur
(function() {
    const pw   = document.getElementById('password');
    const list = document.getElementById('pwChecklistLive');

    list.style.display = "none";

    pw.addEventListener('focus', () => list.style.display = "block");

    pw.addEventListener('blur', () => {
        if (pw.value.trim() === "") list.style.display = "none";
    });
})();

</script>

</body>
</html>
