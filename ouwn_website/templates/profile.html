<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Profile â€¢ OuwN</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Main CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Icons -->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <!-- Header + Breadcrumb-->
    {% include "header.html" %}

    <nav class="ouwn-breadcrumb-bar" role="navigation" aria-label="Breadcrumb">
        <div class="ouwn-crumbs">
            <a class="crumb" href="{{ url_for('dashboard') }}">
                <i class="fa-solid fa-house"></i>
                <span>Dashboard</span>
            </a>
            <span class="sep">/</span>
            <span class="crumb current" aria-current="page">
                <i class="fa-solid fa-user"></i>
                <span>Profile</span>
            </span>
        </div>
    </nav>
    <!--  Flash Banners (Success / Error) -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
          <div class="banner-profile {{ 'ok' if category=='success' else 'err' }} show">
              {{ message }}
          </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

    <!-- Main Profile Section-->
    <main class="auth-container-profile">

        <!-- Profile Header -->
        <div class="profile-header">
            <img src="{{ url_for('static', filename='profile.png') }}" alt="Profile Image">
            <h2>Profile Information</h2>

            <!-- EDIT button -->
            <button type="button" id="editBtn" class="edit-btn-profile" title="Edit profile">
                <i class="fa-solid fa-pen edit-icon"></i>
            </button>
        </div>

        <!-- Profile Form -->
        <form method="POST" class="profile-info" id="profileForm">
            <input type="hidden" name="action" value="update_profile">

            <p>
                <strong>Name:</strong><br>
                <input type="text" name="name" value="{{ user.Name }}" readonly required>
            </p>

            <p>
                <strong>Username:</strong><br>
                <input type="text" name="username" value="{{ user.UserID }}" readonly required>
            </p>

            <p>
                <strong>Email:</strong><br>
                <input type="email" name="email" value="{{ user.Email }}" readonly required>
            </p>

            <!-- Save / Discard buttons -->
            <div class="action-buttons-profile" id="actionButtons">
                <button type="button" class="btn-profile discard" id="discardBtn">Discard Changes</button>
                <button type="submit" class="btn-profile save">Save Changes</button>
            </div>
        </form>

    </main>

    <!--Footer -->
    <footer>
        <p>&copy; 2025 OuwN. All Rights Reserved.</p>
    </footer>

    <script>
        // Buttons and elements
        const editBtn = document.getElementById('editBtn');
        const form = document.getElementById('profileForm');
        const inputs = form.querySelectorAll('input:not([type=hidden])');
        const actionButtons = document.getElementById('actionButtons');
        const discardBtn = document.getElementById('discardBtn');

        // Track edit mode
        let isEditing = false;

        // Store original values for "Discard" button
        const originalValues = {};
        inputs.forEach(input => {
            originalValues[input.name] = input.value;
        });

        // Enable editing
        editBtn.addEventListener('click', () => {
            if (!isEditing) {
                inputs.forEach(i => i.removeAttribute('readonly'));
                form.classList.add('edit-mode');
                actionButtons.classList.add('show');
                editBtn.style.display = 'none';
                isEditing = true;
            }
        });

        // Discard changes + restore original values
        discardBtn.addEventListener('click', () => {
            inputs.forEach(i => {
                i.value = originalValues[i.name];
                i.setAttribute('readonly', true);
            });
            form.classList.remove('edit-mode');
            actionButtons.classList.remove('show');
            editBtn.style.display = 'block';
            isEditing = false;
        });

        // After saving
        form.addEventListener('submit', () => {
            inputs.forEach(i => i.setAttribute('readonly', true));
            form.classList.remove('edit-mode');
            actionButtons.classList.remove('show');
            editBtn.style.display = 'block';
            isEditing = false;
        });

        // Auto-hide banner messages
        const banners = document.querySelectorAll('.banner-profile');
        if (banners.length > 0) {
            banners.forEach(banner => {
                banner.classList.add('show');
                setTimeout(() => banner.classList.remove('show'), 5000);
            });
        }
    </script>

</body>
</html>
